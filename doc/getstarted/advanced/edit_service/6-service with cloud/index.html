<h1 id="invoke-services-in-cloudremote">Invoke Services in Cloud/Remote</h1><p>In some scenarios, the IoT app need to access cloud service, e.g. requesting weather information, face identification, and posting twitter/weibo. Those cloud servies will expose API for users to access, and those APIs could be restful, socket or other kinds. All we need to do is using those API in IoT SOL services, so that we can invoke cloud services.</p><h2 id="example-1-socket-api">Example 1: socket API</h2><p>Node.js provides <a href="https://nodejs.org/api/net.html">net module</a> to support socket communication.</p><p>If there is a weather service in cloud with socket API. After the client send the date to the server, the server will respond the weather history/forecast on that day. * The service has 2 CONFIG item: host and port. It indicates the server address * One inport: date. string, e.g. &quot;20160330&quot; * One outport: info. string, the detailed weather report.</p><p>In kernel.js</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> net <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;net&#39;</span>)<span class="op">;</span>
<span class="kw">var</span> client <span class="op">=</span> <span class="va">net</span>.<span class="at">connect</span>(<span class="op">{</span><span class="dt">port</span><span class="op">:</span> <span class="va">CONFIG</span>.<span class="at">port</span><span class="op">,</span> <span class="dt">host</span><span class="op">:</span> <span class="va">CONFIG</span>.<span class="at">host</span><span class="op">},</span> <span class="kw">function</span>()<span class="op">{</span>
  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;connected to weather server!&#39;</span>)<span class="op">;</span>
  <span class="va">client</span>.<span class="at">write</span>(<span class="va">IN</span>.<span class="at">date</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>
<span class="va">client</span>.<span class="at">on</span>(<span class="st">&#39;data&#39;</span><span class="op">,</span> <span class="kw">function</span>(data) <span class="op">{</span>
  <span class="at">sendOUT</span>(<span class="op">{</span>
    <span class="dt">info</span><span class="op">:</span> <span class="va">data</span>.<span class="at">toString</span>()
  <span class="op">}</span>)<span class="op">;</span>
  <span class="va">client</span>.<span class="at">end</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>
<span class="va">client</span>.<span class="at">on</span>(<span class="st">&#39;end&#39;</span><span class="op">,</span> <span class="kw">function</span>()<span class="op">{</span>
  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;disconnected from weather server&#39;</span>)<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div><h2 id="example-2-restful-api">Example 2: RESTful API</h2><p>Node.js provides <a href="https://nodejs.org/api/http.html">http module</a> to support RESTful API access, such as get and post.</p><p>You can also use the famous 3rd party npm module <a href="https://github.com/request/request">request</a>.</p><p>If there is a simalar weather service with RESTful API. When it receives the GET request in address <code>base_url/date</code>, e.g. <code>http://www.my_weather_service.com/20160330</code>, it will response the weather information on that day. * The service has 1 CONFIG item: url. the base url * One inport: date. string, e.g. &quot;20160330&quot; * One outport: info. string, the detailed weather report.</p><p>In kernel.js</p><div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> request <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;request&quot;</span>)<span class="op">;</span>
<span class="kw">var</span> url <span class="op">=</span> <span class="va">CONFIG</span>.<span class="at">url</span> <span class="op">+</span> <span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="va">IN</span>.<span class="va">date</span>.
<span class="va">request</span>.<span class="at">get</span>(url<span class="op">,</span> <span class="kw">function</span>(e<span class="op">,</span> res<span class="op">,</span> body) <span class="op">{</span>
  <span class="at">sendOUT</span>(<span class="op">{</span>
    <span class="dt">info</span><span class="op">:</span> <span class="va">body</span>.<span class="at">toString</span>()
  <span class="op">}</span>)<span class="op">;</span>
<span class="op">}</span>)</code></pre></div>
